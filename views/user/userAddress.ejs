<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User profile</title>
  <!--===============================================================================================-->
  <link rel="stylesheet" href="/user/style.css" />
  <link rel="icon" type="image/png" href="images/icons/logoVV.png" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.min.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/slick/slick.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/MagnificPopup/magnific-popup.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="css/main.css" />
  <link rel="stylesheet" type="text/css" href="css/util.css" />
  <!--===============================================================================================-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f5f5f5;
      margin-top: 20px;
    }

    .ui-w-80 {
      width: 80px !important;
      height: auto;
    }

    .btn-default {
      border-color: rgba(24, 28, 33, 0.1);
      background: rgba(0, 0, 0, 0);
      color: #4e5155;
    }

    label.btn {
      margin-bottom: 0;
    }

    .btn-outline-primary {
      border-color: #26b4ff;
      background: transparent;
      color: #26b4ff;
    }

    .btn {
      cursor: pointer;
    }

    .text-light {
      color: #babbbc !important;
    }

    .btn-facebook {
      border-color: rgba(0, 0, 0, 0);
      background: #3b5998;
      color: #fff;
    }

    .btn-instagram {
      border-color: rgba(0, 0, 0, 0);
      background: #000;
      color: #fff;
    }

    .card {
      background-clip: padding-box;
      box-shadow: 0 1px 4px rgba(24, 28, 33, 0.012);
    }

    .row-bordered {
      overflow: hidden;
    }

    .account-settings-fileinput {
      position: absolute;
      visibility: hidden;
      width: 1px;
      height: 1px;
      opacity: 0;
    }

    .account-settings-links .list-group-item.active {
      font-weight: bold !important;
    }

    html:not(.dark-style) .account-settings-links .list-group-item.active {
      background: transparent !important;
    }

    .account-settings-multiselect~.select2-container {
      width: 100% !important;
    }

    .light-style .account-settings-links .list-group-item {
      padding: 0.85rem 1.5rem;
      border-color: rgba(24, 28, 33, 0.03) !important;
    }

    .light-style .account-settings-links .list-group-item.active {
      color: #4e5155 !important;
    }

    .material-style .account-settings-links .list-group-item {
      padding: 0.85rem 1.5rem;
      border-color: rgba(24, 28, 33, 0.03) !important;
    }

    .material-style .account-settings-links .list-group-item.active {
      color: #4e5155 !important;
    }

    .dark-style .account-settings-links .list-group-item {
      padding: 0.85rem 1.5rem;
      border-color: rgba(255, 255, 255, 0.03) !important;
    }

    .dark-style .account-settings-links .list-group-item.active {
      color: #fff !important;
    }

    .light-style .account-settings-links .list-group-item.active {
      color: #4e5155 !important;
    }

    .light-style .account-settings-links .list-group-item {
      padding: 0.85rem 1.5rem;
      border-color: rgba(24, 28, 33, 0.03) !important;
    }

    .error-message {
      color: red;
    }
  </style>
  <%- include('../layouts/userLayout/center.ejs') -%>

    <%- include('../layouts/userLayout/navbar.ejs') -%>

      <!-- breadcrumbs -->
      <div class="container">
        <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
          <a href="/home" class="stext-109 cl8 hov-cl1 trans-04">
            Home
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
          </a>
          <a href="/editProfile" class="stext-109 cl8 hov-cl1 trans-04">
            Edit Profile
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
          </a>
          <a href="/userAddress" class="stext-109 cl8 hov-cl1 trans-04">
            Manage Address
            <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
          </a>
        </div>
      </div>

      <div class="container light-style flex-grow-1 border rounded container-p-y mt-5 w-75" style="
        background-color: rgb(250, 249, 246);
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.455);
      ">
        <div class="py-3 mb-4 display-6 text-primary">User Profile</div>
        <div class="card overflow-hidden mb-5 border border-light">
          <div class="row no-gutters row-bordered row-border-light">
            <div class="col-md-3 pt-0">
              <div class="list-group list-group-flush account-settings-links"
                style="background-color: rgb(34, 170, 170)">
                <a class="list-group-item list-group-item-action" href="/editProfile">EDIT PROFILE</a>
                <a class="list-group-item list-group-item-action" href="/order">ORDERS</a>
                <a class="list-group-item list-group-item-action active" href="/userAddress">MANAGE ADDRESS</a>
                <a class="list-group-item list-group-item-action" href="/changePassword">Change Password</a>
                <a class="list-group-item list-group-item-action" href="/wallet">Wallet</a>
              </div>
            </div>
            <div class="col-md-9">
              <button style="margin-left: 5%" type="button" class="btn btn-primary" data-toggle="modal"
                data-target="#addAddressModal">
                Add Address
              </button>
              <div class="tab-content">
                <!-- address List -->
                <div class="container" style="width: 140%">
                  <div class="row">
                    <div class="col-lg-8 col-xl-9 m-lr- m-b-50">
                      <div class="m-lr-25 m-r-38 m-lr-0-xl" style="
                        background-color: rgb(250, 249, 246);
                        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.455);
                      ">
                        <div class="wrap-table-shopping-cart">
                          <table class="table-shopping-cart" id="reloadArea">
                            <!-- Table header -->
                            <tr class="table_row">
                              <td class="column-1">
                                <div class="options fw-bold">
                                  <% user.address.forEach((address, index)=> { %>
                                    <label for="option<%= index + 1 %>" class="op mb-2">
                                      <div class="address-details mt-2">
                                        <span>
                                          <%= address.name %>
                                        </span><br />
                                        <span>
                                          <%= address.housename %>
                                        </span>&nbsp;&nbsp;
                                        <!-- <span>
                                                                            <%= address.place %>
                                                                        </span><br> -->
                                        <span>
                                          <%= address.phone %>
                                        </span><br />
                                        <span>
                                          <%= address.pincode %>
                                        </span>
                                        <div>
                                          <button class="btn btn-outline-primary"
                                            onclick="openCustomModal('<%= address._id %>', '&nbsp;<%= address.name %>', '&nbsp;<%= address.housename %>', '&nbsp;<%= address.place %>', '&nbsp;<%= address.phone %>', '&nbsp;<%= address.pincode %>', '&nbsp;<%= address.state %>')">
                                            Edit
                                          </button>
                                          <button class="btn btn-outline-primary"
                                            onclick="removeAddress('<%=address._id%>')">
                                            Delete
                                          </button>
                                        </div>
                                        <br />
                                        <hr />
                                      </div>
                                    </label>
                                    <br />
                                    <% }) %>
                                </div>
                              </td>
                            </tr>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add Address Modal -->
      <div class="modal" id="addAddressModal">
        <div class="modal-dialog">
          <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Add Address</h4>
              <button type="button" class="close" data-dismiss="modal">
                &times;
              </button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
              <form id="addressForm" method="post" onsubmit="return validateForm()">
                <div class="form-group">
                  <label for="nameInput">Name:</label>
                  <input type="hidden" id="Id" name="id" class="form-control" required />
                  <input type="text" id="nameInput" name="name" class="form-control" required />
                  <span id="nameError" class="error-message"></span>
                </div>
                <div class="form-group">
                  <label for="houseNameInput">House Name:</label>
                  <input type="text" id="houseNameInput" name="houseName" class="form-control" required />
                  <span id="houseNameError" class="error-message"></span>
                </div>
                <div class="form-group">
                  <label for="phoneInput">Phone Number:</label>
                  <input type="tel" id="phoneInput" name="phone" class="form-control" required />
                  <span id="phoneError" class="error-message"></span>
                </div>
                <div class="form-group">
                  <label for="placeInput">Place (City):</label>
                  <input type="text" id="placeInput" name="place" class="form-control" required />
                  <span id="placeError" class="error-message"></span>
                </div>
                <div class="form-group">
                  <label for="pincodeInput">Pincode:</label>
                  <input type="text" id="pincodeInput" name="pincode" class="form-control" required />
                  <span id="pincodeError" class="error-message"></span>
                </div>
                <div class="form-group">
                  <label for="stateInput">State:</label>
                  <input type="text" id="stateInput" name="state" class="form-control" required />
                  <span id="stateError" class="error-message"></span>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- edit adress modal -->
      <div class="modal" id="editAddressModal" style="display: none">
        <div class="modal-dialog">
          <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">Add Address</h4>
              <button type="button" class="close" data-dismiss="modal">
                &times;
              </button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
              <form id="addressForm" method="post">
                <div class="form-group">
                  <label for="nameInput">Name:</label>
                  <input type="hidden" id="id" name="id" class="form-control" required />
                  <input type="text" id="editnameInput" name="name" class="form-control" required />
                </div>
                <div class="form-group">
                  <label for="houseNameInput">House Name:</label>
                  <input type="text" id="edithouseNameInput" name="houseName" class="form-control" required />
                </div>
                <div class="form-group">
                  <label for="phoneInput">Phone Number:</label>
                  <input type="tel" id="editphoneInput" name="phone" class="form-control" required />
                </div>
                <!-- <div class="form-group">
                            <label for="placeInput">Place (City):</label>
                            <input type="text" id="editplaceInput" name="place" class="form-control" required>
                        </div> -->
                <div class="form-group">
                  <label for="pincodeInput">Pincode:</label>
                  <input type="text" id="editpincodeInput" name="pincode" class="form-control" required />
                </div>
                <div class="form-group">
                  <label for="stateInput">State:</label>
                  <input type="text" id="editstateInput" name="state" class="form-control" required />
                </div>
                <button type="button" class="btn btn-secondary"
                  onclick="editAddress(document.getElementById('Id').value)">
                  Update
                </button>
                <button type="button" class="btn btn-outline-primary close-button">
                  Close
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <%- include('../layouts/userLayout/page-footer.ejs') -%>


        <!--===============================================================================================-->
        <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
        <script type="text/javascript"></script>
        <!--===============================================================================================-->
        <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/animsition/js/animsition.min.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/bootstrap/js/popper.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/select2/select2.min.js"></script>
        <script>
          $(".js-select2").each(function () {
            $(this).select2({
              minimumResultsForSearch: 20,
              dropdownParent: $(this).next(".dropDownSelect2"),
            });
          });
        </script>
        <!--===============================================================================================-->
        <script src="vendor/daterangepicker/moment.min.js"></script>
        <script src="vendor/daterangepicker/daterangepicker.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/slick/slick.min.js"></script>
        <script src="js/slick-custom.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/parallax100/parallax100.js"></script>
        <script>
          $(".parallax100").parallax100();
        </script>
        <!--===============================================================================================-->
        <script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
        <script>
          $(".gallery-lb").each(function () {
            // the containers for all your galleries
            $(this).magnificPopup({
              delegate: "a", // the selector for gallery item
              type: "image",
              gallery: {
                enabled: true,
              },
              mainClass: "mfp-fade",
            });
          });
        </script>
        <!--===============================================================================================-->
        <script src="vendor/isotope/isotope.pkgd.min.js"></script>
        <!--===============================================================================================-->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
        <!--===============================================================================================-->
        <script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>

        <!-- validation for add adress -->
        <script>
          function validateForm() {
            // Get form inputs
            var name = document.getElementById('nameInput').value.trim();
            var houseName = document.getElementById('houseNameInput').value.trim();
            var phone = document.getElementById('phoneInput').value.trim();
            var place = document.getElementById('placeInput').value.trim();
            var pincode = document.getElementById('pincodeInput').value.trim();
            var state = document.getElementById('stateInput').value.trim();

            // Regular expressions for validation
            var phoneRegex = /^\d{10}$/;
            var pincodeRegex = /^\d+$/;

            // Clear previous error messages
            clearErrors();

            // Validate each input
            if (name === '') {
              showError('nameError', 'Name is required');
              return false;
            }

            if (houseName === '') {
              showError('houseNameError', 'House Name is required');
              return false;
            }

            if (!phoneRegex.test(phone)) {
              showError('phoneError', 'Invalid phone number (10 digits only)');
              return false;
            }

            if (place === '') {
              showError('placeError', 'Place (City) is required');
              return false;
            }

            if (!pincodeRegex.test(pincode)) {
              showError('pincodeError', 'Invalid pincode (numbers only)');
              return false;
            }

            if (state === '') {
              showError('stateError', 'State is required');
              return false;
            }

            // Form is valid
            return true;
          }

          function showError(id, message) {
            document.getElementById(id).innerHTML = message;
          }

          function clearErrors() {
            var errorElements = document.querySelectorAll('.error-message');
            errorElements.forEach(function (element) {
              element.innerHTML = '';
            });
          }
        </script>


        <!-- loadedit details -->
        <script>
          function openCustomModal(
            id,
            name,
            housename,
            place,
            phone,
            pincode,
            state
          ) {
            console.log(
              "rvgfgbfs",
              id,
              name,
              housename,
              place,
              phone,
              pincode,
              state
            );
            document.getElementById("Id").value = id;
            document.getElementById("editnameInput").value = name;
            document.getElementById("edithouseNameInput").value = housename;
            document.getElementById("editphoneInput").value = phone;
            document.getElementById("editpincodeInput").value = pincode;
            document.getElementById("editstateInput").value = state;
            const modal = document.getElementById("editAddressModal");
            modal.style.display = "block";
            const closeButton = modal.querySelector(".close-button");
            if (closeButton) {
              closeButton.addEventListener("click", function () {
                modal.style.display = "none";
              });
            }
          }
        </script>

        <!-- edit adress -->
        <script>
          function editAddress(addressid) {
            const id = document.getElementById("Id").value;
            const name = document.getElementById("editnameInput").value;
            const house = document.getElementById("edithouseNameInput").value;
            const phone = document.getElementById("editphoneInput").value;
            const pin = document.getElementById("editpincodeInput").value;
            const state = document.getElementById("editstateInput").value;
            const modal = document.getElementById("customModal");
            const data = {
              id: id,
              name: name,
              house: house,
              phone: phone,
              pin: pin,
              state: state,
            };
            $.ajax({
              method: "POST",
              url: "/edit-address",
              data: JSON.stringify(data),
              contentType: "application/json",
              success: function (response) {
                if (response.edited === true) {
                  Swal.fire({
                    icon: "success",
                    text: "Successfully updated",
                  }).then(() => {
                    $("#reloadArea").load("/userAddress #reloadArea");
                  });

                  modal.style.display = "none";
                } else {
                  //  noting hereee because i only pass true
                }
              },
              error: function (error) {
                console.error(error);
              },
            });
          }
        </script>

        <!-- remove address -->
        <script>
          function removeAddress(Addid) {
            const data = {
              Addid: Addid,
            };
            $.ajax({
              method: "POST",
              url: "/delete-address",
              data: JSON.stringify(data),
              contentType: "application/json",
              success: function (response) {
                if (response.deleted === true) {
                  Swal.fire({
                    icon: "success",
                    text: "address deleted",
                  }).then(() => {
                    location.reload();
                  });
                } else {
                }
              },
              error: function (error) {
                console.error(error);
              },
            });
          }
        </script>
        <!--===============================================================================================-->
        <script src="js/main.js"></script>
        </body>

</html>